# PostgreSQL Connection Configuration for K3s Deployment
# This file documents the database connection strings for multi-tenant architecture
# Copy this file to .env.k3s and update with your actual credentials

# PostgreSQL Service Connection Details
# Service Name: postgres (accessible within K3s cluster)
# Port: 5432
# Database: paperless

# Root/Admin User Connection String (for administrative tasks)
# User: paperless (superuser)
# Password: Stored in k8s secret 'paless-secret' key 'db-password'
POSTGRES_ADMIN_CONNECTION=postgresql://paperless:<db-password>@postgres:5432/paperless

# Application User Connection String (for multi-tenant applications)
# User: paperless_app (limited privileges)
# Password: Stored in k8s secret 'paless-secret' key 'paperless-app-password'
POSTGRES_APP_CONNECTION=postgresql://paperless_app:<paperless-app-password>@postgres:5432/paperless

# Development Environment Values (from k8s/overlays/dev/paless-secret-patch.yaml)
# Note: These are for development only. DO NOT use in production.
POSTGRES_ADMIN_CONNECTION_DEV=postgresql://paperless:devpassword@postgres:5432/paperless
POSTGRES_APP_CONNECTION_DEV=postgresql://paperless_app:devapppassword@postgres:5432/paperless

# PostgreSQL Features Enabled
# - PostgreSQL Version: 18.1 (supports all Row-Level Security features)
# - Extensions Enabled:
#   - uuid-ossp: For UUID generation
#   - pgcrypto: For cryptographic functions
# - max_connections: 100 (suitable for multi-tenant load)
# - Permissions for paperless_app user:
#   - SELECT, INSERT, UPDATE, DELETE on all tables in public schema
#   - USAGE, SELECT on all sequences in public schema
#   - Default privileges set for future tables and sequences

# Connection from Outside K3s Cluster
# To connect from your local machine (for debugging):
# 1. Port-forward: kubectl port-forward -n paless svc/postgres 5432:5432
# 2. Connect: postgresql://paperless:devpassword@localhost:5432/paperless

# Connection Testing
# Test from within a K3s pod:
# kubectl run -it --rm psql-test --image=postgres:18 --restart=Never -n paless -- \
#   psql -h postgres -U paperless_app -d paperless -c "SELECT 1;"

# Verification
# Run the verification script to check all multi-tenancy requirements:
# ./scripts/verify-postgres-multitenant.sh

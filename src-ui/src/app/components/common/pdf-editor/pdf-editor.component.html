<pdf-viewer [src]="pdfSrc" [render-text]="false" zoom="0.4" (after-load-complete)="pdfLoaded($event)"></pdf-viewer>
<div class="modal-header">
  <h4 class="modal-title">{{ title }}</h4>
  <button type="button" class="btn-close" aria-label="Close" (click)="cancel()"></button>
</div>
<div class="modal-body">
  <div class="btn-toolbar mb-2">
    <div class="btn-group me-3">
      <button class="btn btn-sm btn-secondary" (click)="selectAll()">
        <i-bs name="check-all"></i-bs>
      </button>
      <button class="btn btn-sm btn-secondary" (click)="deselectAll()" [disabled]="!hasSelection()">
        <i-bs name="x"></i-bs>
      </button>
    </div>
    <div class="btn-group">
      <button class="btn btn-sm btn-secondary" (click)="rotateSelected(-90)" [disabled]="!hasSelection()">
        <i-bs name="arrow-counterclockwise"></i-bs>
      </button>
      <button class="btn btn-sm btn-secondary" (click)="rotateSelected(90)" [disabled]="!hasSelection()">
        <i-bs name="arrow-clockwise"></i-bs>
      </button>
      <button class="btn btn-sm btn-danger" (click)="deleteSelected()" [disabled]="!hasSelection()">
        <i-bs name="trash"></i-bs>
      </button>
    </div>
  </div>
  <div cdkDropList (cdkDropListDropped)="drop($event)" cdkDropListOrientation="mixed" class="d-flex flex-wrap row-cols-5">
    @for (p of pages; track p.page; let i = $index) {
      <div class="page-item rounded p-2" cdkDrag (click)="toggleSelection(i)" [class.selected]="p.selected">
        <div class="btn-toolbar hover-actions z-10">
          <div class="btn-group me-2">
            <button class="btn btn-sm btn-dark" (click)="rotate(i); $event.stopPropagation()">
              <i-bs name="arrow-counterclockwise"></i-bs>
            </button>
            <button class="btn btn-sm btn-dark" (click)="rotate(i); $event.stopPropagation()">
              <i-bs name="arrow-clockwise"></i-bs>
            </button>
          </div>
          <div class="btn-group">
            <button class="btn btn-sm btn-dark text-danger" (click)="remove(i); $event.stopPropagation()">
              <i-bs name="trash"></i-bs>
            </button>
            <button class="btn btn-sm btn-dark" (click)="toggleSplit(i); $event.stopPropagation()">
              <i-bs name="scissors"></i-bs>
            </button>
          </div>
        </div>
        <div class="border-end border-bottom bg-light py-1 px-2 document-check z-10">
          <div class="form-check">
            <input type="checkbox" class="form-check-input" id="page{{i}}"  [checked]="p.selected" (click)="toggleSelection(i); $event.stopPropagation()">
            <label class="form-check-label" for="page{{i}}"></label>
          </div>
        </div>
        <div class="pdf-viewer-container w-100" [class.selected]="p.selected">
          <pdf-viewer [src]="pdfSrc" [page]="p.page" [rotation]="p.rotate" [original-size]="false" [show-all]="false" [render-text]="false"></pdf-viewer>
        </div>
        @if (p.splitAfter) {
          <div class="split-after rounded position-absolute top-0 end-0 bg-dark text-uppercase text-center h-100 px-1 small fw-bold">&mdash; <span i18n>Split here</span> &mdash;</div>
        }
      </div>
    }
  </div>
</div>
<div class="modal-footer">
  <div class="form-check form-switch me-auto">
    <input class="form-check-input" type="checkbox" id="deleteSwitch" [(ngModel)]="deleteOriginal">
    <label class="form-check-label" for="deleteSwitch" i18n>Delete original after edit</label>
  </div>
  <button type="button" class="btn" [class]="cancelBtnClass" (click)="cancel()" [disabled]="!buttonsEnabled">{{ cancelBtnCaption }}</button>
  <button type="button" class="btn" [class]="btnClass" (click)="confirm()" [disabled]="pages.length === 0">{{ btnCaption }}</button>
</div>

<pngx-page-header
  title="Logs"
  i18n-title
  info="Review the log files for the application and for email checking."
  i18n-info>
  <div class="d-flex align-items-center gap-3">
    <div class="form-check form-switch mb-0">
      <input class="form-check-input" type="checkbox" role="switch" [(ngModel)]="autoRefreshEnabled">
      <label class="form-check-label" for="autoRefreshSwitch" i18n>Auto refresh</label>
    </div>
    @if (autoRefreshEnabled) {
      <select class="form-select form-select-sm" style="width: auto;" [(ngModel)]="autoRefreshInterval">
        <option [value]="10">Every 10s</option>
        <option [value]="30">Every 30s</option>
        <option [value]="60">Every 60s</option>
        <option [value]="90">Every 90s</option>
        <option [value]="120">Every 2m</option>
      </select>
    }
  </div>
</pngx-page-header>

<ul ngbNav #nav="ngbNav" [(activeId)]="activeLog" (activeIdChange)="reloadLogs()" class="nav-tabs">
  @for (logFile of logFiles; track logFile) {
    <li [ngbNavItem]="logFile">
      <a ngbNavLink>
        {{logFile}}.log
      </a>
    </li>
  }
  @if (loading || !logFiles.length) {
    <div class="ps-2 d-flex align-items-center">
      <div class="spinner-border spinner-border-sm me-2" role="status"></div>
      @if (!logFiles.length) {
        <ng-container i18n>Loading...</ng-container>
      }
    </div>
  }
</ul>

<div [ngbNavOutlet]="nav" class="mt-2"></div>

<cdk-virtual-scroll-viewport
  itemSize="20"
  class="bg-dark p-3 text-light font-monospace log-container"
  #logContainer>
  @if (isLoadingMore) {
    <div class="text-center py-2">
      <div class="spinner-border spinner-border-sm me-2" role="status"></div>
      <span i18n>Loading older logs...</span>
    </div>
  }
  @if (loading && logFiles.length) {
    <div>
      <div class="spinner-border spinner-border-sm me-2" role="status"></div>
      <ng-container i18n>Loading...</ng-container>
    </div>
  }
  <p *cdkVirtualFor="let log of logs; trackBy: trackByIndex; let i = index"
     class="m-0 p-0"
     [ngClass]="'log-entry-' + log.level">
    <span class="text-muted me-2">[{{i + 1}}]</span>{{log.message}}
  </p>
</cdk-virtual-scroll-viewport>

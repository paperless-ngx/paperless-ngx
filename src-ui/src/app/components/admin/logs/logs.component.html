<pngx-page-header
  title="Logs"
  i18n-title
  info="Review the log files for the application and for email checking."
  i18n-info>
  <div class="input-group input-group-sm align-items-center">
    <div class="input-group input-group-sm me-3">
      <span class="input-group-text text-muted" i18n>Show</span>
      <input
        class="form-control"
        type="number"
        min="100"
        step="100"
        [(ngModel)]="limit"
        (ngModelChange)="onLimitChange($event)"
        style="width: 100px;">
      <span class="input-group-text text-muted" i18n>lines</span>
    </div>
    <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" role="switch" [(ngModel)]="autoRefreshEnabled">
      <label class="form-check-label" for="autoRefreshSwitch" i18n>Auto refresh</label>
    </div>
  </div>
</pngx-page-header>

<ul ngbNav #nav="ngbNav" [(activeId)]="activeLog" (activeIdChange)="reloadLogs()" class="nav-tabs">
  @for (logFile of logFiles; track logFile) {
    <li [ngbNavItem]="logFile">
      <a ngbNavLink>
        {{logFile}}.log
      </a>
    </li>
  }
  @if (loading || !logFiles.length) {
    <div class="ps-2 d-flex align-items-center">
      <div class="spinner-border spinner-border-sm me-2" role="status"></div>
      @if (!logFiles.length) {
        <ng-container i18n>Loading...</ng-container>
      }
    </div>
  }
</ul>

<div [ngbNavOutlet]="nav" class="mt-2"></div>

<cdk-virtual-scroll-viewport
  itemSize="20"
  class="bg-dark p-3 text-light font-monospace log-container"
  #logContainer>
  @if (loading && logFiles.length) {
    <div>
      <div class="spinner-border spinner-border-sm me-2" role="status"></div>
      <ng-container i18n>Loading...</ng-container>
    </div>
  }
  <p *cdkVirtualFor="let log of logs"
     class="m-0 p-0"
     [ngClass]="'log-entry-' + log.level">
    {{log.message}}
  </p>
</cdk-virtual-scroll-viewport>
